# Makefile
# ==========================================================
# üê≥ –ü–ï–†–ï–ú–ï–ù–ù–´–ï (–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏—Ö –æ–¥–∏–Ω —Ä–∞–∑)
# ==========================================================

# –ò–º—è, –∫–æ—Ç–æ—Ä–æ–µ –º—ã –¥–∞–¥–∏–º –Ω–∞—à–µ–º—É "—à–∞–±–ª–æ–Ω—É" (–æ–±—Ä–∞–∑—É)
IMAGE_NAME=frontend-image

# –ò–º—è, –∫–æ—Ç–æ—Ä–æ–µ –º—ã –¥–∞–¥–∏–º –Ω–∞—à–µ–º—É –∑–∞–ø—É—â–µ–Ω–Ω–æ–º—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
CONTAINER_NAME=frontend

# –ü–æ—Ä—Ç, –∫–æ—Ç–æ—Ä—ã–π –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
PORT=5173

# –ü—É—Ç—å –∫ –∫–æ–¥—É (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —ç—Ç–æ–≥–æ Makefile)
FRONTEND_DIR=./frontend

# ==========================================================
# üöÄ –ì–õ–ê–í–ù–ê–Ø –ö–û–ú–ê–ù–î–ê –ó–ê–ü–£–°–ö–ê
# ==========================================================

# (make setup)
# –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ - "–≤—Å–µ-–≤-–æ–¥–Ω–æ–º":
# 1. @make stop - –°–Ω–∞—á–∞–ª–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç –∏ —É–¥–∞–ª–∏—Ç —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å)
# 2. @make build - –°–æ–±–µ—Ä–µ—Ç –æ–±—Ä–∞–∑ (—É—Å—Ç–∞–Ω–æ–≤–∏—Ç 'npm install' –≤–Ω—É—Ç—Ä–∏ Dockerfile)
# 3. @make up - –ó–∞–ø—É—Å—Ç–∏—Ç –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
setup: stop build up
	@echo "--- üöÄ Frontend –∑–∞–ø—É—â–µ–Ω! ---"
	@echo "--- –î–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:$(PORT) ---"

# ==========================================================
# –ë–ê–ó–û–í–´–ï –ö–û–ú–ê–ù–î–´ DOCKER
# ==========================================================

# (make build) - –°–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑ –∏–∑ Dockerfile
# (–≤–∫–ª—é—á–∞—è 'RUN npm install')
build:
	@echo "--- –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ $(IMAGE_NAME)... ---"
	docker build -t $(IMAGE_NAME) $(FRONTEND_DIR)

# (make up) - –ó–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–∑ —Å–æ–±—Ä–∞–Ω–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞
up:
	@echo "--- –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ $(CONTAINER_NAME)... ---"
	docker run -d \
		-p $(PORT):$(PORT) \
		-v $(shell pwd)/$(FRONTEND_DIR):/app \
		-v /app/node_modules \
		--name $(CONTAINER_NAME) \
		$(IMAGE_NAME)

# (make stop) - –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏ —É–¥–∞–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
# (@ –≤ –Ω–∞—á–∞–ª–µ - –ø–æ–¥–∞–≤–ª—è–µ—Ç –≤—ã–≤–æ–¥, || true - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–µ—Ç)
stop:
	@echo "--- –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ $(CONTAINER_NAME) (–µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)... ---"
	@docker stop $(CONTAINER_NAME) || true
	@docker rm $(CONTAINER_NAME) || true

# (make logs) - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ª–æ–≥–∏ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
logs:
	docker logs -f $(CONTAINER_NAME)

# (make npm [–∫–æ–º–∞–Ω–¥–∞]) - –í—ã–ø–æ–ª–Ω—è–µ—Ç NPM –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
# –ü—Ä–∏–º–µ—Ä: make npm install react-router-dom
npm:
	docker exec -it $(CONTAINER_NAME) npm $(filter-out $@,$(MAKECMDGOALS))